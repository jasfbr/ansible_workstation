---

- name: Instala e configura o Google Chrome
  block:

  - name: Baixa o aquivo deb
    block:

    - name: Verifica se o arquivo já foi baixado
      ansible.builtin.stat:
        path: '{{app.chrome.download_path}}/{{app.chrome.file}}'
      register: file_status

    - name: Cria o diretório '{{downloads_path}}/google/chrome'
      ansible.builtin.file:
        path: '{{app.chrome.download_path}}'
        state: directory
        recurse: true
      when: not file_status.stat.exists

    - name: Baixa o arquivo
      ansible.builtin.get_url:
        url: '{{app.chrome.uri}}/{{app.chrome.file}}'
        dest: '{{app.chrome.download_path}}/{{app.chrome.file}}'
        decompress: false
        owner: '{{user.login}}'
        group: '{{user.group}}'
        mode: '0644'
      when: not file_status.stat.exists

  - name: Instala o Google Chrome
    ansible.builtin.apt: 
      deb: '{{app.chrome.download_path}}/{{app.chrome.file}}'
    become: true

- name: Restaura o backup
  ansible.builtin.include_role:
    name: common
    tasks_from: restore_configuration_files.yaml
  vars:
    sources:
      - '.config/google-chrome/'
  when: restaurar_backup

...
